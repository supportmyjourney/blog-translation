<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Donation History</title>
  <style>
    body {
      background: #fefeee;
      font-family: sans-serif;
      font-size: 14px;
      margin: 0;
      padding: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: auto;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    .center {
      text-align: center;
    }
    #showMore {
      margin-top: 10px;
      padding: 5px 10px;
      cursor: pointer;
      border: 1px solid #aaa;
      background: #fff;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Amount (USD)</th>
        <th>Date</th>
        <th>Message</th>
      </tr>
    </thead>
    <tbody id="donationBody">
      <tr><td colspan="4" class="center">Loading...</td></tr>
    </tbody>
  </table>
  <div class="center"><button id="showMore" style="display:none;">Show More</button></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const keyword = urlParams.get("keyword");

    const donationsUrl = `https://opensheet.elk.sh/1AbzUCm0kw5YIVlWHkM1--G2s1hyPNFJr-p76zcQev60/Donations`;
    const maxInitial = 5;
    let allRows = [];
    let shown = 0;

    async function loadHistory() {
      try {
        const res = await fetch(donationsUrl);
        const data = await res.json();
        allRows = data.filter(d => d.keyword === keyword);
        shown = 0;
        renderRows();
      } catch (err) {
        document.getElementById("donationBody").innerHTML =
          `<tr><td colspan="4" class="center">Error loading history.</td></tr>`;
        console.error(err);
      }
    }

    function renderRows() {
      const tbody = document.getElementById("donationBody");
      const nextRows = allRows.slice(shown, shown + maxInitial);
      if (shown === 0) tbody.innerHTML = "";

      for (const row of nextRows) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.name || "Anonymous"}</td>
          <td>$${parseFloat(row.amount || 0).toFixed(2)}</td>
          <td>${row.date || ""}</td>
          <td>${row.message || ""}</td>
        `;
        tbody.appendChild(tr);
      }

      shown += nextRows.length;
      document.getElementById("showMore").style.display =
        shown < allRows.length ? "inline-block" : "none";
    }

    document.getElementById("showMore").onclick = renderRows;
    loadHistory();
  </script>
</body>
</html>
