<!-- ðŸ“ˆ Donation Progress Only -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Donation Progress</title>
  <style>
    body { font-family: sans-serif; font-size: 14px; background: #fcfaee; margin: 0; padding: 10px; }
    .progress-wrapper { margin-bottom: 10px; }
    .progress-text { margin-bottom: 4px; }
    .progress-bar { background: #eee; border-radius: 10px; overflow: hidden; height: 20px; }
    .progress-fill { height: 100%; background: #4caf50; color: white; text-align: center; line-height: 20px; font-size: 12px; }
  </style>
</head>
<body>
  <div class="progress-wrapper">
    <div class="progress-text" id="progress-text">Loading...</div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%">0%</div></div>
  </div>

  <script>
    const sheetId = "1AbzUCm0kw5YIVlWHkM1--G2s1hyPNFJr-p76zcQev60";
    const campaign = new URLSearchParams(location.search).get("campaign") || "";
    const donationsURL = `https://opensheet.elk.sh/${sheetId}/Donations`;
    const targetsURL = `https://opensheet.elk.sh/${sheetId}/Targets`;

    Promise.all([fetch(donationsURL), fetch(targetsURL)])
      .then(responses => Promise.all(responses.map(r => r.json())))
      .then(([donations, targets]) => {
        const total = donations
          .filter(d => d.campaign === campaign)
          .reduce((sum, d) => sum + parseFloat(d.amount || 0), 0);
        
        const targetEntry = targets.find(t => t.keyword === campaign);
        const goal = parseFloat(targetEntry?.goal || 0);

        const percent = goal ? Math.min(100, (total / goal) * 100) : 0;

        document.getElementById("progress-text").textContent =
          `Raised $${total.toFixed(2)} of $${goal.toFixed(2)}`;
        const fill = document.getElementById("progress-fill");
        fill.style.width = `${percent.toFixed(1)}%`;
        fill.textContent = `${percent.toFixed(1)}%`;
      })
      .catch(() => {
        document.getElementById("progress-text").textContent = "Error loading progress.";
      });
  </script>
</body>
</html>
